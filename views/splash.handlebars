 
<script type="text/javascript" src="//d3js.org/d3.v3.min.js"></script>
<script type="text/javascript" src="//cdn.jsdelivr.net/cal-heatmap/3.3.10/cal-heatmap.min.js"></script>
<link rel="stylesheet" href="//cdn.jsdelivr.net/cal-heatmap/3.3.10/cal-heatmap.css" />




<div class="row">
	<div class="col-md-7">
	<p></p>
		{{#if organizations}}
		{{> button-org-user}}
		{{else}}
		<a class="btn btn-success btn-xl" href="/organizations/new"><i class="fa fa-plus" aria-hidden="true"></i> Create an Organization</a> 
		{{/if}}
 

          <h3>Recent Contributions. <small>Click on the item to view the days contributions.</small></h3>
          <div class="panel panel-default">
            <div class="panel-body">
             <div id="cal-heatmap"></div>

           </div>
         </div>


         <div>
         	<h3>Recent activity</h3> 
         	<div style="border-width: 2px; border-style: dashed; border-color: grey;padding:55px;text-align: center;border-radius: 5px;"><strong>Welcome!</strong> You are just getting started, setup you profile, create an organization then get started with a new component.</div>
         </div>


	</div>
	<div class="col-md-5">
	<p></p>

		<h3>Components <small>you contribute to <span class="badge" id="compcount">0</span></small></h3>
		<div class="panel panel-default"  id="components" style="display: none;">
			<div class="panel-body">
				<div>
					<!-- Nav tabs -->
					<ul class="nav nav-tabs" role="tablist">
						<li role="presentation" class="active"><a href="#home" aria-controls="home" role="tab" data-toggle="tab">All</a></li>
						<li role="presentation"><a href="#profile" aria-controls="profile" role="tab" data-toggle="tab">Public</a></li>
						<li role="presentation"><a href="#messages" aria-controls="messages" role="tab" data-toggle="tab">Private</a></li>
					</ul>
					<!-- Tab panes -->
					<div class="tab-content">
						<div role="tabpanel" class="tab-pane active" id="home">
							<p></p>
							<table class="table table-bordered table-condensed" id="componentstable" > 
								<thead>
									<tr>
										<th>Description</th>
									</tr>
								</thead>
								<tbody>
								</tbody>
							</table>
						</div>
						<div role="tabpanel" class="tab-pane" id="profile"> <p></p>
							<table class="table table-bordered table-condensed" id="componentstablePublic" > 
								<thead>
									<tr>
										<th>Description</th>
									</tr>
								</thead>
								<tbody>
								</tbody>
							</table> 

						</div>
						<div role="tabpanel" class="tab-pane" id="messages"> <p></p>
							<table class="table table-bordered table-condensed" id="componentstablePrivate" > 
								<thead>
									<tr>
										<th>Description</th>
									</tr>
								</thead>
								<tbody>
								</tbody>
							</table> 

						</div>
					</div>

				</div>
			</div>
		</div>
		<a class="btn btn-success " href="/component/new">Create a Component</a> 
		<h3>Assemblies <small>you contribute to <span class="badge" id="compcount">0</span></small></h3>
		<div class="panel panel-default"  id="components"  >
			<div class="panel-body">
				<div>
					<!-- Nav tabs -->
					<ul class="nav nav-tabs" role="tablist">
						<li role="presentation" class="active"><a href="#home" aria-controls="home" role="tab" data-toggle="tab">All</a></li>
						<li role="presentation"><a href="#profile" aria-controls="profile" role="tab" data-toggle="tab">Public</a></li>
						<li role="presentation"><a href="#messages" aria-controls="messages" role="tab" data-toggle="tab">Private</a></li>
					</ul>
					<!-- Tab panes -->
					<div class="tab-content">
						<div role="tabpanel" class="tab-pane active" id="home">
							<p></p>
							<table class="table table-bordered table-condensed" id=" " > 
								<thead>
									<tr>
										<th>Description</th>
									</tr>
								</thead>
								<tbody>
								</tbody>
							</table>
						</div>
						<div role="tabpanel" class="tab-pane" id="profile"> <p></p>
							<table class="table table-bordered table-condensed" id="componentstablePublic" > 
								<thead>
									<tr>
										<th>Description</th>
									</tr>
								</thead>
								<tbody>
								</tbody>
							</table> 

						</div>
						<div role="tabpanel" class="tab-pane" id="messages"> <p></p>
							<table class="table table-bordered table-condensed" id="componentstablePrivate" > 
								<thead>
									<tr>
										<th>Description</th>
									</tr>
								</thead>
								<tbody>
								</tbody>
							</table> 

						</div>
					</div>

				</div>
			</div>
		</div>

<a class="btn btn-success  " href="/assembly/new">Create an Assembly</a> 

	</div>


</div>


<script type="text/javascript">
  var itemsParse = {{{itemsParse}}}
  var componentlistParse = {{{componentlistParse}}}
  var componentlistParseall = {{{componentlistParseall}}}
  var userorgcomplistParse = {{{userorgcomplistParse}}}
	function componentList(){
 
//User Components innto table
var temp = []
var count =0
var htms = ''
var htmpublic = ''
var htmprivate = ''
for (var i = 0; i < componentlistParse.length; i++) {
	for (var j = 0; j < componentlistParseall.length; j++) {
		if (componentlistParse[i].elementID == componentlistParseall[j].parentid) {
			if (componentlistParseall[j].visibility == 'private') {
				htms += '<tr><td><a>'+componentlistParse[i].name+'</a>   <span class="label label-success">Private</span></td></tr>'
				htmprivate += '<tr><td><a>'+componentlistParse[i].name+'</a>   <span class="label label-success">Private</span></td></tr>'
			} else {
				htms += '<tr><td><a>'+componentlistParse[i].name+'</a></td></tr>'
				htmpublic += '<tr><td><a>'+componentlistParse[i].name+'</a></td></tr>'
			}
			temp.push(componentlistParseall[j]+' / '+componentlistParse[i].name)
		}
	}
}
count = temp.length
//org componentns by user into form
var temp = []
var html = ''
var htmlpublic = ''
var htmlprivate = ''
for (var i = 0; i < componentlistParse.length; i++) {
	for (var j = 0; j < userorgcomplistParse.length; j++) {
		if (componentlistParse[i].elementID == userorgcomplistParse[j].parentid) {
			if (userorgcomplistParse[j].visibility == 'private') {
				html += '<tr><td><a>'+userorgcomplistParse[j].organizationowner+' / '+componentlistParse[i].name+'</a>   <span class="label label-success">Private</span></td></tr>'
				htmlprivate +='<tr><td><a>'+userorgcomplistParse[j].organizationowner+' / '+componentlistParse[i].name+'</a>   <span class="label label-success">Private</span></td></tr>'
			} else {
				html += '<tr><td><a>'+userorgcomplistParse[j].organizationowner+' / '+componentlistParse[i].name+'</a></td></tr>'
				htmlpublic +='<tr><td><a>'+userorgcomplistParse[j].organizationowner+' / '+componentlistParse[i].name+'</a></td></tr>'
			}
			temp.push(userorgcomplistParse[j].organizationowner+' / '+componentlistParse[i].name)
		}
	}
}
if (count + temp.length == 0) {       
	var html = '<tr><td><a>No Components</a></td></tr>'
	var htmlpublic = '<tr><td><a>No Components</a></td></tr>'
	var htmlprivate = '<tr><td><a>No Components</a></td></tr>'
}  else {
	$('#components').show();
}
$('#componentstable').append(htms)
$('#componentstablePublic').append(htmpublic)
$('#componentstablePrivate').append(htmprivate)
$('#componentstable').append(html)
$('#componentstablePublic').append(htmlpublic)
$('#componentstablePrivate').append(htmlprivate)
//component count
$('#compcount').html(count + temp.length)
var table = jQuery('#componentstable').DataTable({
	'destroy':true,
	"pagingType": "numbers",   "bLengthChange": false, "dom": '<lf<t>ip>',"bInfo" : false
//  'order': [[ 2, 'asc' ]] ,
});
var table = jQuery('#componentstablePublic').DataTable({
	'destroy':true,
	"pagingType": "numbers",   "bLengthChange": false, "dom": '<lf<t>ip>',"bInfo" : false
//  'order': [[ 2, 'asc' ]] ,
});
var table = jQuery('#componentstablePrivate').DataTable({
	'destroy':true,
	"pagingType": "numbers",   "bLengthChange": false, "dom": '<lf<t>ip>',"bInfo" : false
//  'order': [[ 2, 'asc' ]] ,
});
}
///////////////////////////// 
//////  INITIALISE    //////
/////////////////////////// 
$( document ).ready(function() {
	  heatmap()
 
	componentList()
});

///////////////////////////// 
//////  HEAT MAP      //////
/////////////////////////// 
function heatmap(){
 var parserData = function (data) {
  var dataJSON = {};
  for(var i=0; i<data.length; i++) {
    var date = new Date(data[i].created); // Date of activity 
    var sec = date.getTime()/1000; // Convert to sec
    // Pair "Key-Value" for calendar data
    if(dataJSON[sec]) {
      dataJSON[sec]++;
    } else {
      dataJSON[sec] = 1;
    }
  }

  return dataJSON;
}
var cal = new CalHeatMap();
cal.init({
   itemSelector: "#cal-heatmap",
  domain: "month",
  subDomain: "day",
 // cellSize: 20,
  //subDomainTextFormat: "%d",
  range: 8,
start: new Date(2016, 10),
   data: itemsParse, // Dates Array
   afterLoadData: parserData      // Parser function
});
}

</script>